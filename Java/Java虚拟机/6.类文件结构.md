# 类文件结构

## 概述

不同的操作系统对应的JVM支持统一的程序存储格式、字节码，使得Java可以运行是与平台无关的(平台无关性)。
实现无关性的基础是虚拟机和字节码存储结构。Java虚拟机只跟Class这种特定的二进制文件关联。而且上层的语言可以是任意的语言，只要编译出符合规范的Class文件(语言无关性)。

## Class类文件的结构

Class类文件是一组以8个字节为基础单位的二进制流。

如果需要8个字节以上空间的数据项时，会按照高位在前的方式分割成若干个8字节。

只存在"无符号数"和"表"

| 类型           | 名称                | 数量                  |
| -------------- | ------------------- | --------------------- |
| u4             | magic               | 1                     |
| u2             | minor_version       | 1                     |
| u2             | major_version       | 1                     |
| u2             | constant_pool_count | 1                     |
| cp_info        | constant_pool       | constant_pool_count-1 |
| u2             | access_flags        | 1                     |
| u2             | this_class          | 1                     |
| u2             | super_class         | 1                     |
| u2             | interfaces_count    | 1                     |
| u2             | interfaces          | interfaces_count      |
| u2             | fields_count        | 1                     |
| field_info     | fileds              | fields_count          |
| u2             | method_count        | 1                     |
| method_info    | methods             | method_count          |
| u2             | attributes_count    | 1                     |
| attribute_info | attributes          | attributes_count      |

### magic(魔数)与Class文件的版本

每个Class文件的开头4个字节为魔数。唯一作用是确定这个文件是否为能被虚拟机接受的Class文件

Class文件的魔数为0xCAFFVABABE

后面四个字节(minor_version和major_version)分别为次版本号和主版本号。高版本能兼容低版本，但不能运行后续版本的Class文件。

### 常量池

紧接着上述部分是常量池的入口。

常量池通常是占用空间最大的部分。

